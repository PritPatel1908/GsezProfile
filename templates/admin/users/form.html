{% extends "admin/base.html" %}

{% block title %}{% if user_form.instance.pk %}Edit User{% else %}Add New User{% endif %} | GSEZ Admin Panel{% endblock %}

{% block users_active %}active{% endblock %}

{% block extra_css %}
<style>
    .form-container {
        margin-bottom: 30px;
    }
    
    .form-header {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        border-radius: 15px;
        padding: 25px;
        margin-bottom: 25px;
        position: relative;
        overflow: hidden;
        color: white;
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }
    
    .form-header::before {
        content: '';
        position: absolute;
        top: -50px;
        right: -50px;
        width: 200px;
        height: 200px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.1);
        z-index: 0;
    }
    
    .form-header::after {
        content: '';
        position: absolute;
        bottom: -80px;
        left: -80px;
        width: 300px;
        height: 300px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.05);
        z-index: 0;
    }
    
    .form-header-content {
        position: relative;
        z-index: 1;
    }
    
    .breadcrumb {
        background: transparent;
        padding: 0;
        margin-bottom: 15px;
    }
    
    .breadcrumb-item a {
        color: rgba(255, 255, 255, 0.8);
        transition: all 0.2s ease;
    }
    
    .breadcrumb-item a:hover {
        color: white;
        text-decoration: none;
    }
    
    .breadcrumb-item.active {
        color: white;
    }
    
    .breadcrumb-item + .breadcrumb-item::before {
        color: rgba(255, 255, 255, 0.6);
    }
    
    .form-title {
        font-size: 1.8rem;
        font-weight: 700;
        margin-bottom: 5px;
    }
    
    .form-subtitle {
        color: rgba(255, 255, 255, 0.8);
        font-size: 1rem;
    }
    
    .form-card {
        background-color: white;
        border-radius: 15px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        overflow: hidden;
        margin-bottom: 25px;
    }
    
    .form-card-header {
        padding: 20px 25px;
        border-bottom: 1px solid #f1f1f1;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }
    
    .form-card-title {
        font-size: 1.1rem;
        font-weight: 600;
        margin: 0;
        display: flex;
        align-items: center;
    }
    
    .form-card-title i {
        margin-right: 10px;
        color: var(--primary-color);
    }
    
    .form-card-body {
        padding: 25px;
    }
    
    .form-section {
        margin-bottom: 30px;
    }
    
    .form-section:last-child {
        margin-bottom: 0;
    }
    
    .section-title {
        font-size: 1rem;
        font-weight: 600;
        margin-bottom: 20px;
        color: #343a40;
        display: flex;
        align-items: center;
    }
    
    .section-title i {
        margin-right: 8px;
        color: var(--primary-color);
    }
    
    .form-label {
        font-weight: 500;
        color: #495057;
        margin-bottom: 8px;
    }
    
    .form-control, .form-select {
        border-radius: 10px;
        padding: 12px 15px;
        border: 1px solid #dee2e6;
        transition: all 0.2s ease;
    }
    
    .form-control:focus, .form-select:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 0.25rem rgba(var(--primary-rgb), 0.25);
    }
    
    .form-text {
        font-size: 0.8rem;
        color: #6c757d;
    }
    
    .form-check-input {
        width: 1.2rem;
        height: 1.2rem;
        margin-top: 0.15rem;
    }
    
    .form-check-input:checked {
        background-color: var(--primary-color);
        border-color: var(--primary-color);
    }
    
    .form-check-label {
        padding-left: 5px;
    }
    
    .form-buttons {
        display: flex;
        justify-content: space-between;
        margin-top: 30px;
    }
    
    .btn {
        padding: 10px 20px;
        border-radius: 10px;
        font-weight: 500;
        transition: all 0.2s ease;
    }
    
    .btn-primary {
        background-color: var(--primary-color);
        border-color: var(--primary-color);
    }
    
    .btn-primary:hover {
        background-color: var(--secondary-color);
        border-color: var(--secondary-color);
        transform: translateY(-2px);
    }
    
    .btn-outline-secondary {
        color: #6c757d;
        border-color: #6c757d;
    }
    
    .btn-outline-secondary:hover {
        background-color: #6c757d;
        color: white;
        transform: translateY(-2px);
    }
    
    .help-card {
        background-color: #f8f9fa;
        border-radius: 15px;
        padding: 20px;
    }
    
    .help-title {
        font-size: 1rem;
        font-weight: 600;
        margin-bottom: 15px;
        color: #343a40;
    }
    
    .help-subtitle {
        font-size: 0.9rem;
        font-weight: 600;
        margin: 15px 0 10px;
        color: #495057;
    }
    
    .help-text {
        font-size: 0.85rem;
        color: #6c757d;
        margin-bottom: 10px;
    }
    
    .help-list {
        padding-left: 20px;
        margin-bottom: 15px;
    }
    
    .help-list li {
        font-size: 0.85rem;
        color: #6c757d;
        margin-bottom: 5px;
    }
    
    .help-list li strong {
        color: #495057;
    }
    
    .role-badge {
        display: inline-block;
        padding: 5px 10px;
        border-radius: 6px;
        font-size: 0.75rem;
        font-weight: 500;
        margin-right: 8px;
        margin-bottom: 8px;
    }
    
    .role-admin {
        background-color: rgba(52, 152, 219, 0.1);
        color: #3498db;
    }
    
    .role-hr {
        background-color: rgba(155, 89, 182, 0.1);
        color: #9b59b6;
    }
    
    .role-security {
        background-color: rgba(241, 196, 15, 0.1);
        color: #f1c40f;
    }
    
    .role-company {
        background-color: rgba(230, 126, 34, 0.1);
        color: #e67e22;
    }
    
    .role-user {
        background-color: rgba(46, 204, 113, 0.1);
        color: #2ecc71;
    }
    
    .alert {
        border-radius: 10px;
        padding: 15px 20px;
    }
    
    .invalid-feedback {
        font-size: 0.8rem;
        margin-top: 5px;
    }
    
    @media (max-width: 767.98px) {
        .form-buttons {
            flex-direction: column;
            gap: 10px;
        }
        
        .form-buttons .btn {
            width: 100%;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="form-container">
    <div class="form-header" data-aos="fade-down">
        <div class="form-header-content">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{% url 'admin_dashboard' %}">Dashboard</a></li>
                    <li class="breadcrumb-item"><a href="{% url 'admin_users' %}">User Management</a></li>
                    <li class="breadcrumb-item active">{% if user_form.instance.pk %}Edit User{% else %}Add New User{% endif %}</li>
                </ol>
            </nav>
            <h1 class="form-title">{% if user_form.instance.pk %}Edit User{% else %}Add New User{% endif %}</h1>
            <p class="form-subtitle">
                {% if user_form.instance.pk %}
                Update information for {{ user_form.instance.get_full_name }}
                {% else %}
                Create a new user account in the system
                {% endif %}
            </p>
        </div>
    </div>
    
    <div class="row">
        <div class="col-lg-8">
            <form method="post" class="needs-validation" novalidate enctype="multipart/form-data">
                {% csrf_token %}
                
                {% if form.non_field_errors %}
                <div class="alert alert-danger mb-4">
                    {% for error in form.non_field_errors %}
                        {{ error }}
                    {% endfor %}
                </div>
                {% endif %}
                
                <!-- Basic Information -->
                <div class="form-card" data-aos="fade-up" data-aos-delay="100">
                    <div class="form-card-header">
                        <h5 class="form-card-title">
                            <i class="bi bi-person"></i> Basic Information
                        </h5>
                    </div>
                    <div class="form-card-body">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="{{ user_form.first_name.id_for_label }}" class="form-label">First Name</label>
                                <input type="text" name="{{ user_form.first_name.name }}" 
                                       id="{{ user_form.first_name.id_for_label }}" 
                                       class="form-control {% if user_form.first_name.errors %}is-invalid{% endif %}"
                                       value="{{ user_form.first_name.value|default:'' }}" required>
                                {% if user_form.first_name.errors %}
                                <div class="invalid-feedback">
                                    {% for error in user_form.first_name.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                                {% endif %}
                            </div>
                            <div class="col-md-6">
                                <label for="{{ user_form.last_name.id_for_label }}" class="form-label">Last Name</label>
                                <input type="text" name="{{ user_form.last_name.name }}" 
                                       id="{{ user_form.last_name.id_for_label }}" 
                                       class="form-control {% if user_form.last_name.errors %}is-invalid{% endif %}"
                                       value="{{ user_form.last_name.value|default:'' }}" required>
                                {% if user_form.last_name.errors %}
                                <div class="invalid-feedback">
                                    {% for error in user_form.last_name.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="{{ user_form.username.id_for_label }}" class="form-label">Username</label>
                                <input type="text" name="{{ user_form.username.name }}" 
                                       id="{{ user_form.username.id_for_label }}" 
                                       class="form-control {% if user_form.username.errors %}is-invalid{% endif %}"
                                       value="{{ user_form.username.value|default:'' }}" required>
                                {% if user_form.username.errors %}
                                <div class="invalid-feedback">
                                    {% for error in user_form.username.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                                {% endif %}
                            </div>
                            <div class="col-md-6">
                                <label for="{{ user_form.email.id_for_label }}" class="form-label">Email</label>
                                <input type="email" name="{{ user_form.email.name }}" 
                                       id="{{ user_form.email.id_for_label }}" 
                                       class="form-control {% if user_form.email.errors %}is-invalid{% endif %}"
                                       value="{{ user_form.email.value|default:'' }}" required>
                                {% if user_form.email.errors %}
                                <div class="invalid-feedback">
                                    {% for error in user_form.email.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Password Section -->
                {% if not user_form.instance.pk %}
                <div class="form-card" data-aos="fade-up" data-aos-delay="200">
                    <div class="form-card-header">
                        <h5 class="form-card-title">
                            <i class="bi bi-key"></i> Password
                        </h5>
                    </div>
                    <div class="form-card-body">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="{{ user_form.password1.id_for_label }}" class="form-label">Password</label>
                                <input type="password" name="{{ user_form.password1.name }}" 
                                       id="{{ user_form.password1.id_for_label }}" 
                                       class="form-control {% if user_form.password1.errors %}is-invalid{% endif %}" required>
                                {% if user_form.password1.errors %}
                                <div class="invalid-feedback">
                                    {% for error in user_form.password1.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                                {% endif %}
                                <div class="form-text">{{ user_form.password1.help_text }}</div>
                            </div>
                            <div class="col-md-6">
                                <label for="{{ user_form.password2.id_for_label }}" class="form-label">Confirm Password</label>
                                <input type="password" name="{{ user_form.password2.name }}" 
                                       id="{{ user_form.password2.id_for_label }}" 
                                       class="form-control {% if user_form.password2.errors %}is-invalid{% endif %}" required>
                                {% if user_form.password2.errors %}
                                <div class="invalid-feedback">
                                    {% for error in user_form.password2.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}
                
                <!-- Role and Permissions -->
                <div class="form-card" data-aos="fade-up" data-aos-delay="300">
                    <div class="form-card-header">
                        <h5 class="form-card-title">
                            <i class="bi bi-shield"></i> Role & Permissions
                        </h5>
                    </div>
                    <div class="form-card-body">
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <label for="{{ role_form.role.id_for_label }}" class="form-label">User Role</label>
                                <select name="{{ role_form.role.name }}" 
                                       id="{{ role_form.role.id_for_label }}" 
                                       class="form-select {% if role_form.role.errors %}is-invalid{% endif %}">
                                    {% for value, text in role_form.role.field.choices %}
                                        <option value="{{ value }}" {% if role_form.role.value == value %}selected{% endif %}>{{ text }}</option>
                                    {% endfor %}
                                </select>
                                {% if role_form.role.errors %}
                                <div class="invalid-feedback">
                                    {% for error in role_form.role.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                                {% endif %}
                            </div>
                            <div class="col-md-6">
                                <label for="{{ role_form.is_skip_profile.id_for_label }}" class="form-label">Profile Status</label>
                                <div class="form-check mt-2">
                                    <input type="checkbox" name="{{ role_form.is_skip_profile.name }}" 
                                           id="{{ role_form.is_skip_profile.id_for_label }}" 
                                           class="form-check-input {% if role_form.is_skip_profile.errors %}is-invalid{% endif %}"
                                           {% if role_form.is_skip_profile.value %}checked{% endif %}>
                                    <label class="form-check-label" for="{{ role_form.is_skip_profile.id_for_label }}">
                                        Skip Profile Creation
                                    </label>
                                    {% if role_form.is_skip_profile.errors %}
                                    <div class="invalid-feedback">
                                        {% for error in role_form.is_skip_profile.errors %}
                                            {{ error }}
                                        {% endfor %}
                                    </div>
                                    {% endif %}
                                    <div class="form-text">{{ role_form.is_skip_profile.help_text }}</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-check mb-3">
                                    <input type="checkbox" name="is_active" id="is_active" 
                                           class="form-check-input"
                                           {% if not user_form.instance.pk or user_form.instance.is_active %}checked{% endif %}>
                                    <label class="form-check-label" for="is_active">
                                        Active Account
                                    </label>
                                    <div class="form-text">Designates whether this user should be treated as active.</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check mb-3">
                                    <input type="checkbox" name="is_staff" id="is_staff" 
                                           class="form-check-input"
                                           {% if user_form.instance.is_staff %}checked{% endif %}>
                                    <label class="form-check-label" for="is_staff">
                                        Staff Status
                                    </label>
                                    <div class="form-text">Designates whether the user can log into the Django admin site.</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="form-buttons">
                    <a href="{% url 'admin_users' %}" class="btn btn-outline-secondary">
                        <i class="bi bi-arrow-left me-1"></i> Cancel
                    </a>
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-{% if user_form.instance.pk %}save{% else %}plus-circle{% endif %} me-1"></i>
                        {% if user_form.instance.pk %}Update User{% else %}Create User{% endif %}
                    </button>
                </div>
            </form>
        </div>
        
        <div class="col-lg-4">
            <div class="form-card" data-aos="fade-up" data-aos-delay="100">
                <div class="form-card-header">
                    <h5 class="form-card-title">
                        <i class="bi bi-info-circle"></i> Help & Information
                    </h5>
                </div>
                <div class="form-card-body">
                    <div class="help-card">
                        <h6 class="help-title">User Roles</h6>
                        <div class="mb-3">
                            <span class="role-badge role-admin">
                                <i class="bi bi-shield-lock me-1"></i> Administrator
                            </span>
                            <span class="role-badge role-hr">
                                <i class="bi bi-people me-1"></i> HR Manager
                            </span>
                            <span class="role-badge role-security">
                                <i class="bi bi-shield me-1"></i> Security
                            </span>
                            <span class="role-badge role-company">
                                <i class="bi bi-building me-1"></i> Company
                            </span>
                            <span class="role-badge role-user">
                                <i class="bi bi-person me-1"></i> Regular User
                            </span>
                        </div>
                        
                        <h6 class="help-subtitle">Role Descriptions</h6>
                        <ul class="help-list">
                            <li><strong>Administrator:</strong> Full access to all features</li>
                            <li><strong>HR Manager:</strong> Can manage job postings and applications</li>
                            <li><strong>Security Personnel:</strong> Can scan QR codes and log access</li>
                            <li><strong>Company Representative:</strong> Can manage company profile and job postings</li>
                            <li><strong>Regular User:</strong> Basic access to profile and job applications</li>
                        </ul>
                        
                        <h6 class="help-subtitle">Profile Status</h6>
                        <p class="help-text">Administrators can skip profile creation. This is useful for admin accounts that don't need a physical GSEZ ID.</p>
                        
                        {% if not user_form.instance.pk %}
                        <h6 class="help-subtitle">Password Guidelines</h6>
                        <ul class="help-list">
                            <li>Must contain at least 8 characters</li>
                            <li>Cannot be too similar to personal information</li>
                            <li>Cannot be a commonly used password</li>
                            <li>Cannot be entirely numeric</li>
                        </ul>
                        {% endif %}
                        
                        <h6 class="help-subtitle">Next Steps</h6>
                        <p class="help-text">
                            {% if user_form.instance.pk %}
                            After updating this user, you can manage their permissions or edit their profile details.
                            {% else %}
                            After creating this user, you'll need to set up their profile with details like GSEZ ID, nationality, and other required information.
                            {% endif %}
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}